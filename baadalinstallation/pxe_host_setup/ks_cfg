#Generated by Kickstart Configurator
#platform=x86
logging --host=CONTROLLER_IP --port=514 --level=debug
#System language
lang en_US
#Language modules to install
langsupport en_IN --default=en_US
#System keyboard
keyboard us
#System mouse
mouse
#System timezone
timezone Asia/Kolkata
#Root password
rootpw --iscrypted $1$/4ksSDdC$QpZKK9Dyy4QnObPnEY7Z..
#Initial user
user baadalhost --fullname "Baadal Host" --iscrypted --password $1$/ehGLNTG$jxEnH4EBuK.4Emnkm67X1/
#Reboot after installation
reboot
#Install OS instead of upgrade
install
#Use Web installation
url --url http://CONTROLLER_IP/ubuntu-12.04-server-amd64
#System bootloader configuration
bootloader --location=mbr
#Clear the Master Boot Record
zerombr yes
#Partition clearing information
clearpart --all --initlabel
#Disk partitioning information
part swap --size 8192 --onpart sda1
part / --fstype ext4 --size 1 --grow 
#System authorization infomation
auth  --useshadow  --enablemd5
#Network information
network --bootproto=dhcp --hostname=baadal-host --device=eth0
#Firewall configuration
firewall --disabled
#Do not configure the X Window System
skipx

%packages
openssh-server
make
%post

(mkdir -p /baadal
cd /baadal
wget http://CONTROLLER_IP/newbaadal.tar

tar xvf newbaadal.tar
rm newbaadal.tar

cp /etc/apt/sources.list /etc/apt/sources.list.bak
cp /baadal/baadal/baadalinstallation/pxe_host_setup/sources.list /etc/apt/sources.list

apt-get update
apt-get -y install linux-image-3.2.0-29

ln -s /baadal/baadal/baadalinstallation/pxe_host_setup/host_installation.sh /etc/init.d/host_installation.sh
update-rc.d host_installation.sh defaults

cd /baadal
wget http://CONTROLLER_IP/.ssh/id_rsa.pub
mkdir -p /root/.ssh
touch /root/.ssh/authorized_keys
cat id_rsa.pub >> /root/.ssh/authorized_keys
rm id_rsa.pub) 1> /var/log/installation.log 2>&1  

%end
